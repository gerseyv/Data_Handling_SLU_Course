---
title: "DataHandlingCourse"
format: html
editor: visual
---

## Quarto

Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see <https://quarto.org>.

## Running Code

When you click the **Render** button a document will be generated that includes both content and the output of embedded code. You can embed code like this:

Transforming cases data to long format.

```{r}
setwd("C:/GerseyNotSLU/Datahandlingcourse/")
library(tidyverse)
cases <- read.csv("cases.txt")
cases_long <- cases %>% 
  pivot_longer(
    cols = starts_with("X20"), 
    names_to = "year", 
    values_to = "counts"
    )

```

Transforming pollution data to wide format.

```{r}
pollution <- read.csv("pollution.txt")
pollution_wide <- pollution %>% 
  pivot_wider(
  names_from = size,
  values_from = amount
)
#reverse
pollution_long <- pollution_wide %>% 
  pivot_longer(
    cols = c(large, small),
    names_to = "size", #define the column for the variable
    values_to = "amount") #for values


```

Transforming storm dataset into separate year-month-day format

```{r}
storm <- read.csv("storms.txt")
storm_s1 <- storm %>% 
  separate(date,
           c("y", "m", "d"),
           sep = "-")

#put them back
storm_u1 <- storm_s1 %>% 
  unite("DATE", y, m, d,
        sep = "_")

```

Practice exercise

```{r}
gapminder <- read.csv("https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/main/episodes/data/gapminder_data.csv")
gapminder <- as_tibble(gapminder) # make it tibble or tbl data type too
head(gapminder) # print couple of lines
str(gapminder)

gap_wide <- read.csv("https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/gh-pages/data/gapminder_wide.csv", stringsAsFactors = FALSE)
str(gap_wide)

gap_long1 <- gap_wide %>%
pivot_longer(
cols = c(starts_with('pop'), starts_with('lifeExp'), starts_with('gdpPercap')),
names_to = "obstype_year", values_to = "obs_values"
)
str(gap_long)

gap_long2 <- gap_wide %>%
pivot_longer(
cols = c(-continent, -country),
names_to = "obstype_year", values_to = "obs_values"
)

tail(gap_long)

gap_long <- gap_long %>% separate(obstype_year, into = c('obs_type', 'year'), sep = "_")
gap_long$year <- as.integer(gap_long$year) # 'chr' to 'int'

gap_normal <- gap_long %>%
pivot_wider(names_from = obs_type, values_from = obs_values)

gap_normal <- gap_normal[, names(gapminder)] #ask about how this works, how does it organize the columns?
all.equal(gap_normal, gapminder)

library(dplyr)
gap_normal <- gap_normal %>% arrange(country, year)
all.equal(gap_normal, gapminder)

gap_temp <- gap_long %>% unite(var_ID, continent, country, sep = "_")
str(gap_temp)

gap_temp <- gap_long %>%
unite(ID_var, continent, country, sep = "_") %>%
unite(var_names, obs_type, year, sep = "_")
str(gap_temp)

gap_wide_new <- gap_long %>%
unite(ID_var, continent, country, sep = "_") %>%
unite(var_names, obs_type, year, sep = "_") %>%
pivot_wider(names_from = var_names, values_from = obs_values)
str(gap_wide_new)

gap_wide_betterID <- gap_long %>%
unite(ID_var, continent, country, sep = "_") %>%
unite(var_names, obs_type, year, sep = "_") %>%
pivot_wider(names_from = var_names, values_from = obs_values) %>%
separate(ID_var, c("continent","country"), sep = "_")
str(gap_wide_betterID)

gap_wide <- as_tibble(gap_wide)
all.equal(gap_wide, gap_wide_betterID)

```



